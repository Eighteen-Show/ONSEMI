<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Report</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const noIssueCheckbox = document.querySelector('input[name="no_issue"]');
            const otherCheckboxes = document.querySelectorAll('input[name="eye"], input[name="teeth"], input[name="skin"], input[name="back"], input[name="other"]');

            function toggleCheckboxes() {
                if (noIssueCheckbox.checked) {
                    otherCheckboxes.forEach(checkbox => checkbox.disabled = true);
                } else {
                    otherCheckboxes.forEach(checkbox => checkbox.disabled = false);
                }

                if (Array.from(otherCheckboxes).some(checkbox => checkbox.checked)) {
                    noIssueCheckbox.disabled = true;
                } else {
                    noIssueCheckbox.disabled = false;
                }
            }

            noIssueCheckbox.addEventListener('change', toggleCheckboxes);
            otherCheckboxes.forEach(checkbox => checkbox.addEventListener('change', toggleCheckboxes));

            // Initialize state on page load
            toggleCheckboxes();

            document.getElementById('other').addEventListener('change', function() {
                var otherText = document.getElementById('other_text');
                if (this.checked) {
                    otherText.style.display = 'block';
                } else {
                    otherText.style.display = 'none';
                }
            });
        });
    </script>
</head>
<body>
    <h1>보고서 수정</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <h3>Status</h3>
        <div>
            <label>{{report.status}}</label>
        </div>

        <h3>Notes</h3>
        <div>
            <label><input type="checkbox" name="no_issue" {% if report.no_issue %}checked{% endif %}> 특이사항 없음</label>
        </div>
        <div>
            <label><input type="checkbox" name="eye" {% if report.eye %}checked{% endif %}> 눈</label>
        </div>
        <div>
            <label><input type="checkbox" name="teeth" {% if report.teeth %}checked{% endif %}> 치아</label>
        </div>
        <div>
            <label><input type="checkbox" name="skin" {% if report.skin %}checked{% endif %}> 피부</label>
        </div>
        <div>
            <label><input type="checkbox" name="back" {% if report.back %}checked{% endif %}> 허리</label>
        </div>
        <div>
            <label><input type="checkbox" name="other" id="other" {% if report.other %}checked{% endif %}> 기타</label><br>
            <input type="text" name="other_text" id="other_text" value="{{ report.other_text }}" {% if not report.other %}style="display:none;"{% endif %}>
        </div>

        <h3>Upload Images</h3>
        <input type="file" name="images" multiple>
        <button type="submit" name="add_image">Upload Images</button>
        {% comment %} <ul>
            {% for image in images %}
                <li>{{ image.image.url }} <button type="submit" name="delete_image" value="{{ image.id }}">Delete</button></li>
            {% endfor %}
        </ul> 
        <button type="submit" name="delete_all_images">Delete All Images</button>{% endcomment %}

        <h3>의사 소견</h3>
        <textarea name="doctor_opinion">{{ report.doctor_opinion }}</textarea>

        <h3>전달 사항</h3>
        <textarea name="user_request">{{ report.user_request }}</textarea>

        <br>
        <input type="submit" value="등록">
        <button type="submit" name="delete_report">삭제</button>
        
        {% comment %} <h2>Uploaded Images</h2>
            <ul>
            {% for image in images %}
                <li><img src="{{ image.image.url }}" alt="Image">{{ image.image.name }}</li>
            {% endfor %} {% endcomment %}
    </form>
</body>
</html>
