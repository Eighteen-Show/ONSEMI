<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report List</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
           
        }
        th, td {
            padding: 8px 12px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f4f4f4;
            cursor: pointer;
        }

        .clickable-row {
            cursor: pointer;
        }
        .clickable-row:hover {
            background-color: #f0f0f0;
        }

        .table-care {
            background-color: #FFE4E1;
        }

        .table-report {
            background-color: #E0FFFF; 
        }
        .button-cell {
            text-align: center;
            padding: 0; /* Padding 제거 */
        }

        .button-cell button {
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: none;
            background-color: #e0a797;
            color: black;
            cursor: pointer;
            font-size: 14px;
            margin: 0; /* Margin 제거 */
            padding: 12px; /* Padding 추가 */
        }

        .button-cell button:hover {
            background-color: #d5869d;
        }
    </style>
    
</head>
<body>
    <h1>보고서 목록</h1>

    <form method="get">
        <label for="sort_by">정렬:</label>
        <select name="sort_by" id="sort_by">
            <option value="-created_at">최신순</option>
            <option value="created_at">오래된 순</option>
        </select>
        <label for="status_filter">상태:</label>
        <select name="status_filter" id="status_filter">
            <option value="all">전체</option>
            <option value="completed">등록완료</option>
            <option value="not_completed">미등록</option>
        </select>
        {% comment %} <label for="user">신청자:</label>
        <select name="user" id="user">
            <option value="">전체</option>
            {% for user in users %}
                {% if user.user_type == 'FAMILY' %}
                    <option value="{{ user.id }}" {% if user.id == user_id %}selected{% endif %}>{{ user.username }}</option>
                {% endif %}
            {% endfor %}
        </select> {% endcomment %}
        <label for="senior">대상 어르신:</label>
        <select name="senior_ids" id="senior" multiple>
            <option value="">전체</option>
            {% for senior in seniors %}
                <option value="{{ senior.id }}" {% if senior.id|stringformat:"s" in senior_ids %}selected{% endif %}>{{ senior.name }}</option>
            {% endfor %}
        </select>

        <button type="submit">적용</button>
    </form>
    <div>
        <h2>작성해야 할 보고서: {{ pending_reports_count }}개</h2>
    </div>
    <table class="table-care">
        <thead>
            <tr>
                <th>케어 타입</th>
                <th>케어 신청 날짜</th>
                <th>제목</th>
                <th>내용</th>
                <th>대상 어르신</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for care in cares %}
                <tr>
                    <td>{{ care.care_type }}</td>
                    <td>{{ care.datetime }}</td>
                    <td>{{ care.title }}</td>
                    <td>{{ care.content }}</td>
                    <td>{% for senior in care.seniors.all %}
                        {{ senior.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}</td>
                    <td class="button-cell">
                        <button type="button" onclick="location.href='{% url 'management_app:create_report' care.id %}'">보고서 작성 버튼</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>작성된 보고서 리스트</h2>
    <table class="table-report">
        <thead>
            <tr>
                <th>보고서 상태</th>
                <th>등록 시간</th>
                <th>제목</th>
                <th>대상 어르신</th>
            </tr>
        </thead>
        <tbody>
            {% for report in page_obj %}
                <tr class="clickable-row" onclick="location.href='{% url 'management_app:manage_report' report.id %}'">
                    <td>{{ report.status }}</td>
                    <td>{{ report.created_at }}</td>
                    <td>{{ report.care.title }}</td>
                    <td>{% for senior in report.care.seniors.all %}
                        {{ senior.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; 처음</a>
                <a href="?page={{ page_obj.previous_page_number }}">이전</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">다음</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">마지막 &raquo;</a>
            {% endif %}
        </span>
    </div>
</body>
</html>

<script>
    function checkPendingReports(pendingReportsCount, careId) {
        if (pendingReportsCount === 0) {
            alert('작성해야 할 보고서가 없습니다.');
        } else {
            location.href = '{% url "management_app:create_report" 0 %}'.replace('0', careId);
        }
    }

</script>
