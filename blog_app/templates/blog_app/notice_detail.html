<!DOCTYPE html>
<html lang="en">
<head>
    {% extends "layout.html" %}
    {% load static %}
    <meta charset="UTF-8">
    {% block title %}<title>{{ notice.title }}</title>{% endblock %}
    {% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'base.css' %}">
    <style>
        div.header{
            background-color: #fff;
        }
        
    </style>
    {% endblock %}
</head>
<body>
    {% block content %}
    <div class="header">
        <img src="{% static 'main/onsemi.png' %}" alt="Logo">
        <nav>
            <a href="/">홈</a>
            <a href="introduce/">소개</a>
            {% if request.user.is_authenticated %}
            <a href="/user/logout/" class="logout">로그아웃</a>
            {% else %}
            <a href="user/login/">로그인</a>
            {% endif %}
            
            {% if request.user.is_authenticated %}
            <a href="user/profile/">나의 정보</a>
            {% else %}
            <a href="user/register/">회원가입</a>
            {% endif %}
            <a href="blog/notice_list/">공지사항</a>
            <a href="user_page/">사용자 페이지</a>

            {% if request.user.is_authenticated %}
            {% endif %}
    </div>
    <header>
        <div class="container">
            <h1>{{ notice.title }}</h1>
        </div>
    </header>
    <div class="container main-content-post">
        <p>{{ notice.content }}</p>
        
        
        {% if notice.image %}
            <img src="{{ notice.image.url }}" alt="{{ notice.title }}">
        {% endif %}
        <p>Published on: {{ notice.datetime }}</p>
        <p>Views: {{ notice.views }}</p>
        
        <div class="action-buttons">
            {% if user == notice.user_id %}
                <a href="{% url 'blog_app:notice_edit' pk=notice.pk %}" class="button">글 수정하기</a>
                <button onclick="confirmDeletePost({{ notice.pk }})" class="button">글 삭제하기</button>
            {% endif %}
        </div>
        </form>
        <button onclick="location.href='{% url 'blog_app:notice_list' %}'">목록으로 돌아가기</button>
    </div>

    <script>
        function confirmDeletePost(postId) {
            if (confirm('정말 포스트를 삭제하시겠습니까?')) {
                fetch(`/blog/${postId}/delete/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                }).then(response => {
                    if (response.ok) {
                        window.location.href = '/blog/notice_list';
                    } else {
                        alert('Failed to delete the notice.');
                    }
                });
            }
        }
    </script>
    {% endblock %}
</body>
</html>