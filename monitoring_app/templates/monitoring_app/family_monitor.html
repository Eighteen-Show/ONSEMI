{% extends "monitoring_app/layout.html" %}
{% load static %}
 
{% block title %}ONSEMI{% endblock %}
<!DOCTYPE html><html lang="ko">
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<script src="{% static 'js/scripts.js' %}"></script>
{% endblock %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        .senior-photo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .senior-photo img {
            max-width: 150px;
            height: auto;
            border-radius: 10px;
        }
        
        .sidebar h3 {
            margin-top: 0;
        }

        .photo-box {
            overflow-y: auto;
        }

        .photo-box::-webkit-scrollbar {
            display: none; /* 스크롤 바 숨기기 */
        }

        .health-box {
            overflow-y: auto;
        }

        .health-box::-webkit-scrollbar {
            display: none; /* 스크롤 바 숨기기 */
        }
        .image-box {
            text-decoration: none;
            color: black;
        }
    </style>
</head>
<body>
        <div class="container">
            <div class="sidebar">
                {% if selected_senior %}
                    <div class="senior-photo">
                        {% if selected_senior.photo %}
                            <img src="{{ selected_senior.photo.url }}" alt="{{ selected_senior.name }}">
                        {% else %}
                            <p>사진 없음</p>
                        {% endif %}
                    </div>
                {% endif %}
                <h3>{{ selected_senior.name }}</h3>
                <form method="get" id="seniorForm">
                    <select name="selected_senior_id" onchange="document.getElementById('seniorForm').submit();">
                        <option value="">전체</option>
                        {% for senior in seniors %}
                            <option value="{{ senior.id }}" {% if selected_senior_id == senior.id|stringformat:"s" %}selected{% endif %}>{{ senior.name }}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>
            <div class="main-content">
                <div class="image-container">
                    <div class="photo-box">
                        <p>사진</p><br>
                        {% if not selected_senior_id or selected_senior_id == report.care.senior.id|stringformat:"s" %}
                            {% for report in reports %}
                            <a href="{% url 'monitoring_app:family_monitor_image' report.id %}" class="image-box">
                            <tr>
                                {% if report.images.all %}
                                    <td>{% for senior in report.care.seniors.all %}
                                        {{ senior.name }}{% if not forloop.last %}, {% endif %}님
                                    {% endfor %}</td>
                                    <td>{{ report.created_at }}</td><br>
                                <td>
                                {% for image in report.images.all %}
                                    <img src="{{ image.image.url }}" alt="Report Image" style="max-width: 200px; max-height: 200px;">
                                {% endfor %}
                                    {% endif %}
                                </td>
                            </tr></a><br>
                            {% endfor %}
                        {% else %}
                            {% for report in reports %}
                                {% if forloop.first %}
                                <a href="{% url 'monitoring_app:family_monitor_image' report.id %}" class="image-box">
                                <tr>
                                    {% if report.images.all %}
                                        <td>{% for senior in report.care.seniors.all %}
                                            {{ senior.name }}{% if not forloop.last %}, {% endif %}님
                                        {% endfor %}</td>
                                        <td>{{ report.created_at }}</td><br>
                                    <td>
                                    {% for image in report.images.all %}
                                        <img src="{{ image.image.url }}" alt="Report Image" style="max-width: 200px; max-height: 200px;">
                                    {% endfor %}
                                        {% endif %}
                                    </td>
                                </tr></a><br>
                                {% endif %}
                            {% endfor %}
                        {% endif %}    
                    </div>
                    <div class="health-box">
                        <p>건강 상태</p><br>
                        <button class="plus-button" onclick="location.href='/monitoring/diagnosis/?selected_senior_id={{ selected_senior_id }}';">+</button>
                        {% if not selected_senior_id or selected_senior_id == report.care.senior.id|stringformat:"s" %}
                            {% for report in reports %}
                            <tr>
                                <td>{% for senior in report.care.seniors.all %}
                                    {{ senior.name }}{% if not forloop.last %}, {% endif %}님
                                {% endfor %}</td>
                                <td>{{ report.created_at }}</td><br>
                                <td>
                                    {% if report.no_issue %}
                                        특이사항 없음
                                    {% else %}
                                        {% if report.eye %}
                                            눈 진찰 필요
                                        {% endif %}
                                        {% if report.teeth %}
                                            치아 진찰 필요
                                        {% endif %}
                                        {% if report.skin %}
                                            피부 진찰 필요
                                        {% endif %}
                                        {% if report.back %}
                                            허리 진찰 필요
                                        {% endif %}
                                        {% if report.other %}
                                            {{report.other_text}} 진찰 필요
                                        {% endif %}
                                    {% endif %}
                            </tr><br><br>
                            {% endfor %}
                        {% else %}
                                {% for report in reports %}
                                    {% if forloop.first %}
                                    <tr>
                                        <td>{% for senior in report.care.seniors.all %}
                                            {{ senior.name }}{% if not forloop.last %}, {% endif %}님
                                        {% endfor %}</td>
                                        <td>{{ report.created_at }}</td><br>
                                        <td>
                                            {% if report.no_issue %}
                                                특이사항 없음
                                            {% else %}
                                                {% if report.eye %}
                                                    눈 진찰 필요
                                                {% endif %}
                                                {% if report.teeth %}
                                                    치아 진찰 필요
                                                {% endif %}
                                                {% if report.skin %}
                                                    피부 진찰 필요
                                                {% endif %}
                                                {% if report.back %}
                                                    허리 진찰 필요
                                                {% endif %}
                                                {% if report.other %}
                                                    {{report.other_text}} 진찰 필요
                                                {% endif %}
                                            {% endif %}
                                    </tr><br><br>
                                    {% endif %}
                                {% endfor %}
                        {% endif %}
                    </div>
                    <div class="order-box">
                        <p>주문 및 돌봄 내역</p>
                        <button class="plus-button" onclick="location.href='{% url 'monitoring_app:generate' %}';">+</button>
                        <a href='/management/add/care/' class="add">새로운 케어 요청하기</a>
                        <table>
                            <thead>
                                <tr>
                                    <th>제목</th>
                                    <th>케어 종류</th>
                                    <th>요청 날짜</th>
                                    <th>처리 상태</th>
                                    <th>요청 내용</th>
                                    <th>대상 노인</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for care in cares %}
                                <tr class="clickable-row" onclick="location.href='/management/care/detail/{{ care.id }}/'">
                                    <td>{{ care.title }}</td>
                                    <td>{{ care.care_type }}</td>
                                    <td>{{ care.datetime }}</td>
                                    <td>{{ care.care_state }}</td>
                                    <td>{{ care.content }}</td>
                                    <td>
                                        {% for senior in care.seniors.all %}
                                            {{ senior.name }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>                
                    </div>
                </div>
            </div>
        </div>
    </div></body>
{% endblock %}
</html>