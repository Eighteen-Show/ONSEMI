{% extends "shop/product/base_shop.html" %}
{% load static %}

{% block title %}
  장바구니
{% endblock %}

{% block content %}
{{ block.super }}
  <div class="cart-container">
    <h1>장바구니</h1>
    {% if insufficient_stock %}
      <p class="error">재고가 부족합니다.</p>
    {% endif %}
    <table class="cart">
      <thead>
        <tr>
          <th>상품</th>
          <th>수량</th>
          <th>삭제</th>
          <th>가격</th>
          <th>합계</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart %}
          {% with product=item.product %}
            <tr>
              <td class="product-cell">
                <a href="{{ product.get_absolute_url }}">
                  <div class="product-info">
                    <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static "img/no_image.png" %}{% endif %}" class="product-image">
                    <span class="product-name">{{ item.product.name }}</span>
                  </div>
                </a>
              </td>
              <td>
                <form action="{% url "cart_app:cart_add" product.id %}" method="post">
                  {{ item.update_quantity_form.quantity }}
                  {{ item.update_quantity_form.override }}
                  <input type="submit" value="변경">
                  {% csrf_token %}
                </form>
              </td>
              <td>
                <form action="{% url "cart_app:cart_remove" product.id %}" method="post">
                  <input type="submit" value="삭제">
                  {% csrf_token %}
                </form>
              </td>
              <td class="num">{{ item.price }}원</td>
              <td class="num">{{ item.total_price }}원</td>
            </tr>
          {% endwith %}
        {% endfor %}
        <tr class="total">
          <td>결제금액</td>
          <td colspan="3"></td>
          <td class="num">{{ cart.get_total_price }}원</td>
        </tr>
      </tbody>
    </table>
    <div class="cart-actions">
      <a href="{% url "shop_app:product_list" %}" class="button continue-shopping">계속 쇼핑하기</a>
      <a href="{% url "orders_app:order_create" %}" class="button checkout-button">주문하기</a>
    </div>
  </div>
{% endblock %}
</body>
</html>

<style>
  .cart-container {
    width: 80%;
    margin: 0 auto;
  }

  .cart {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  .cart th, .cart td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }

  .product-cell {
    text-align: left;
  }

  .product-info {
    display: flex;
    align-items: center;
  }

  .product-image {
    width: 100px; /* Increased width */
    height: 100px; /* Increased height */
    object-fit: cover;
    margin-right: 10px;
  }

  .product-name {
    vertical-align: middle;
  }

  .num {
    text-align: right;
  }

  .total {
    font-weight: bold;
  }

  .cart-actions {
    display: flex;
    justify-content: space-between;
  }

  .button {
    padding: 10px 20px;
    text-decoration: none;
    background-color: #4CAF50;
    color: white;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  .button:hover {
    background-color: #45a049;
  }

  .continue-shopping {
    background-color: #008CBA;
  }

  .continue-shopping:hover {
    background-color: #007bb5;
  }

  .checkout-button {
    background-color: #f44336;
  }

  .checkout-button:hover {
    background-color: #da190b;
  }
</style>
