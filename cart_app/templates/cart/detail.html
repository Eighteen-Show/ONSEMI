{% extends "shop/product/base_shop.html" %}
{% load static %}

{% block title %}
  장바구니
{% endblock %}

{% block content %}
<style>
  .cart-container {
    width: 80%;
    margin: 0 auto;
  }

  .cart {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  .cart th, .cart td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }

  .product-cell {
    text-align: left;
  }

  .product-info {
    display: flex;
    align-items: center;
  }

  .product-image {
    width: 100px; /* Increased width */
    height: 100px; /* Increased height */
    object-fit: cover;
    margin-right: 10px;
  }

  .product-name {
    vertical-align: middle;
  }

  .num {
    text-align: right;
  }

  .total {
    font-weight: bold;
  }

  .cart-actions {
    display: flex;
    justify-content: space-between;
  }

  .button {
    padding: 10px 20px;
    text-decoration: none;
    background-color: #4CAF50;
    color: white;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  .button:hover {
    background-color: #45a049;
  }

  .continue-shopping {
    background-color: #008CBA;
  }

  .continue-shopping:hover {
    background-color: #007bb5;
  }

  .checkout-button {
    background-color: #f44336;
  }

  .checkout-button:hover {
    background-color: #da190b;
  }
  .modal {
    display: none; /* 숨겨진 상태로 시작 */
    position: fixed; /* 페이지 스크롤해도 고정 */
    z-index: 1; /* 다른 내용보다 위에 표시 */
    left: 0;
    top: 0;
    width: 100%; /* 전체 화면 너비 */
    height: 100%; /* 전체 화면 높이 */
    overflow: auto; /* 필요시 스크롤 */
    background-color: rgb(0, 0, 0); /* 배경색 */
    background-color: rgba(0, 0, 0, 0.4); /* 배경색 투명도 조절 */
  }
  
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 상단에서 아래로 이동 */
    padding: 20px;
    border: 1px solid #888;
    width: 40%; /* 너비 */
  }
  
  .close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }
  
  .close-button:hover,
  .close-button:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }
  
  .alert {
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid transparent;
    border-radius: 4px;
  }
  
  .alert-error {
    color: #a94442;
    background-color: #f2dede;
    border-color: #ebccd1;
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var modal = document.getElementById("message-modal");
    var closeButton = document.querySelector(".close-button");

    if (modal) {
      modal.style.display = "block";

      closeButton.addEventListener("click", function() {
        modal.style.display = "none";
      });

      window.addEventListener("click", function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      });
    }
  });
</script>
{{ block.super }}
  <div class="cart-container">
    <h1>장바구니</h1>
    {% comment %} {% if insufficient_stock %}
      <p class="error">재고가 부족합니다.</p>
    {% endif %} {% endcomment %}
    {% if messages %}
    <div id="message-modal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        {% for message in messages %}
          <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <table class="cart">
      <thead>
        <tr>
          <th>상품</th>
          <th>수량</th>
          <th>삭제</th>
          <th>가격</th>
          <th>합계</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart %}
          {% with product=item.product %}
            <tr>
              <td class="product-cell">
                <a href="{{ product.get_absolute_url }}">
                  <div class="product-info">
                    <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static "img/no_image.png" %}{% endif %}" class="product-image">
                    <span class="product-name">{{ item.product.name }}</span>
                  </div>
                </a>
              </td>
              <td>
                <form action="{% url "cart_app:cart_detail" %}" method="post">
                  {{ item.update_quantity_form.quantity }}
                  {{ item.update_quantity_form.override }}
                  <input type="hidden" name="product_id" value="{{ product.id }}">
                  <input type="submit" value="변경">
                  {% csrf_token %}
                </form>
              </td>
              <td>
                <form action="{% url "cart_app:cart_remove" product.id %}" method="post">
                  <input type="submit" value="삭제">
                  {% csrf_token %}
                </form>
              </td>
              <td class="num">{{ item.price }}원</td>
              <td class="num">{{ item.total_price }}원</td>
            </tr>
          {% endwith %}
        {% endfor %}
        <tr class="total">
          <td>결제금액</td>
          <td colspan="3"></td>
          <td class="num">{{ cart.get_total_price }}원</td>
        </tr>
      </tbody>
    </table>
    <div class="cart-actions">
      <a href="{% url "shop_app:product_list" %}" class="button continue-shopping">계속 쇼핑하기</a>
      <a href="{% url "orders_app:order_create" %}" class="button checkout-button">주문하기</a>
    </div>
  </div>
</body>
</html>
{% endblock %}